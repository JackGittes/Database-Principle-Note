## 数据库原理与应用 第五十六讲 关系模式的规范化

- 作者：**赵明心**
- 日期：**2019年9月4日**

---

### **6.1.1 1NF**

关系型数据库中不允许表中套表，尽管现在Oracle数据库等对RDBMS进行了扩展，支持一些对象型数据，突破了1NF的限制，但我们从关系型数据库的角度讲仍然需要满足1NF要求。我们在做数据库的时候，发现客户存在这样一张表，表格有姓名、部门、地址（省、市、街道）。如果用关系型数据库来建立的话是无法建的，因为不能套表，这时候一种方法就是将表格拉平。或者用另外一种方法，再建立一张表格，一张表格记录雇员的编号和部门，另外一张表格记录雇员编号和省、市、街道信息。不管怎么样，都无法以非1NF的方式建表。

### **6.1.2 2NF**

如果一个关系是一范式的，而且不存在属性之间的函数依赖关系，那就是一个二范式。判断是不是二范式就看主键就可以。

这张表当中，学号和课程号合在一起是一个主键，如果学号和课程号合在一起可以决定成绩，姓名、年龄、地址可以单独通过学号来确定而不需要依赖于课程号。姓名、年龄、地址对主键存在部分函数依赖，只对“学号+课程号”主键中的学号有依赖。设计数据库的时候，如果把学生表设计成这个样子，不满足二范式关系就会带来很多问题。

非二范式带来的问题：
- 插入异常：例如一个新生来报到了，他一门课都还没选，那么这个时候姓名、年龄、地址这些都无法插入，因为需要满足主键不能为空的要求，那么就需要等学生至少选择了一门课之后才能插入该学生的信息。
- 删除异常：如果一个学生生病了，病休一个学期，并且退选了所有的课程，那么这个时候就会出现其基本信息也会丢失的情况，因为删除了课程之后，主键丢失，基本信息也就丢失。
- 难于更新：更新的时候很难维护数据的一致性，因为表格中存在大量的数据冗余，同一个学生如果选修了50门课程，那么他的信息没有必要重复出现50次，数据如果存在冗余的话，在更新的时候就会很麻烦。基本信息随着选修课程的增加，冗余会很多，如果需要修改家庭地址，那么就需要修改很多条记录。这种结构上的冗余就是不必要的。

如何解决这种问题呢？
> 解决的方法很简单，尽管书上介绍了很多内容，对我们数据库设计进行指导的话，抽象出来就4个字：**一事一地**。所谓**一事一地**就是一张表只管一件事情，拆分表格。学生信息表可以拆分成学生基本信息和选课信息两个表，这样就很清楚了。学生基本信息和选课情况混在一起就会出问题。根据一事一地的原则，就可以满足二范式。**one fact in one place**，消除对主键的部份依赖。

当学生基本信息需要更新的时候，只需要更新基本信息表就可以。其他地方都是以引用的形式出现，解决了更新困难的问题。

### **6.1.3 3NF**

如果一个关系属于2NF，同时不存在属性对主键的传递依赖，那么它就是3NF的。

举例来看，关于雇员关系信息的表格，每个雇员有一个雇员编号，下面的SALARY是工资，首先这个表格的主键是职工编号，职工编号一旦确定，其工资级别也会确定。这张表格中就不存在部分依赖关系。这个表格满足2NF的要求，但是它符不符合3NF要求呢？

具体的工资数对于雇员编号来说是传递依赖，因为一个员工的编号确定了之后，其工资级别也就确定了，工资级别确定了之后其工资也就确定了。那么雇员编号和工资之间存在传递依赖。所以这个表不是3NF的，我们看一下表格不满足3NF的时候会遇到什么问题。

- 插入异常：当单位中，每个员工的工资级别还没有确定的时候，那么工资和级别之间的关系无法确定。例如新成立的公司，新招了一批员工，由于工资级还没有确定，那么工资级和工资的对照关系无法确定，导致信息无法录入。
- 删除异常：在一个工资中拿三级工资的人只有一个人，例如是5000元，只有张三一个人拿三级工资。如果张三这个员工离职，那么三级工资与三级工资之间的对应关系也不存在了。这个关系按道理是一个客观存在，不应该因为员工的离职而删掉。
- 难于更新：由于存在大量冗余，更新的时候比较难于维护数据的一致性。

例如在一个单位中，如果拿三级工资的有100个人，那么拿三级工资的人的工资级和工资之间的关系会重复100次。如果公司更新了工资级与工资之间的关系，就会需要修改100条记录。