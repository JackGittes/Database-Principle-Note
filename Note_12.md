## 数据库原理与应用 第十二讲 关系演算

- 作者：**赵明心**
- 日期：**2019年8月1日**

---

## 二（五） 关系演算 Relational Calculus(续)

- 关系代数需要指定关系代数操作之间的序关系，而关系演算只需要指定获取结果所需要的逻辑条件。
- SQL语言就是建立在关系演算基础之上的，关系演算有两种类型：元组关系演算（Tuple Relational Calculus, TPC）和域关系演算（Domain Relational Calculus, DRC）
- 演算具有变量、常量、比较运算符、逻辑连接和
  - TRC：变量值在元组上
  - DRC：变量值在域元素（属性值）上
  - TRC和DRC都是一阶谓词逻辑的简单子集

两种方式的变量单位不同。

## 二（六） 域关系演算

- 变量定义在属性上，查询的一般形式：
  - $\{<x_1,x_2...,x_n>| P(x_1,x_2,...x_{n+1},..x_{n+m})\}$
- $x_1,x_2...,x_{m+n}$被称为域变量，$<x_1...x_n>$出现在查询结果中
- 查询结果包含了使得表达式$P$为真的所有$<x_1...x_n>$元组
- 表达式可以递归定义，以简单的原子表达式开始（），利用逻辑连接符构成更复杂更大的公式

### **2.6.1 DRC公式**

- 原子公式：
  - $<x_1,x_2...x_n>\in Rname$
  - $op$是原子运算符的一个
- 公式：
  - 一个原子公式就是一个公式，或者
  - $\neg p,p\bigwedge q,q\vee p$，其中的$p,q$是公式，或者
  - $\exist X(p(X))$，其中的变量$X$在公式$p(X)$中是非绑定的，或者
  - $\forall X(p(X))$，其中变量在$p(X)$是非绑定的

什么是绑定或者free？如果在一个域变量上面存在量词，存在量词或者全称量词，那么就称这个变量是被绑定的，如果没有就是非绑定的（free）。关系演算就是在寻找能使公式P为真的这组变量值中$n$个变量组成的结果。要求出现在结果中的$<x_1,x_2,...x_n>$是自由的。

### **2.6.2 域关系演算的例子**

查找级别大于7的水手，在关系代数上面是一个非常简单的操作，就是选择操作，如果是查找级别大于7的水手的姓名，那么只需要再做一次投影就可以。

- ${<I,N,T,A>|<I,N,T,A>\in Sailors \bigwedge T>7}$
- 条件$<I,N,T,A>\in Sailors$确保了域变量$I,N,T$和$A$被绑定在水手元组的相同域上
- $<I,N,T,A>$项在符号“|”的左侧（应读作“such that”，以使得）说明每个满足$T>7$的元组$<I,N,T,A>$都是答案

首先那一项应该在表中，其次要满足$T>7$。

### **2.6.3 不安全查询（Unsafe Queries）和关系演算的表达能力(Expressive Power)**

- 有可能写出一个语法上正确的查询但是可以有无穷多的答案，这样的查询被称为不安全的：
  - ${S|\neg (S\in Sailors)}$，此表达式查找所有不出现在水手表中的水手，这个结果显然是无限的，不安全的查询是无意义的，关系代数中不存在这样的问题
- 每种关系代数查询都可以表示成一种安全的域关系演算或元组关系演算，反之也成立，说明关系代数和关系演算等价
- 关系完备性，$\{\sigma,\pi,\cup,-,\times\}$是关系完备的操作集，已经经过了严格的数学证明。关系型数据库查询语言SQL是建立在关系演算基础之上的，所以SQL语言可以表达关系演算所能够表达的任何查询。

由此关系代数和关系演算的是等价的。

## 二（7） 元组关系演算

域关系演算和元组关系演算是完全相同的，只不过在变量上有所不同。

- 查询的形式：
  - ${t[<attribute list>]|P(t)}$
- $t$被称为元组变量：
  - 答案包括所有使得公式$P$为真的元组$t<attribute list>$
  - 查询例子：查找所有级别大于7且年龄小于50的水手的名字：${t[N]|t\in Sailors \ t.T>7 \bigwedge	t.A<50>}$



