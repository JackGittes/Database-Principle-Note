## 数据库原理与应用 第三十六讲 索引技术

- 作者：**赵明心**
- 日期：**2019年8月18日**

---

### **4.3.1 文件组织（续）**

RAW DISK是操作系统在文件管理更底层提供的对磁盘你文件进行管理的机制，可以由用户控制文件在磁盘上的存储方式。在使用操作系统进行文件管理的时候无法控制文件在底层的存储。例如创建了一个文件f.dat，当往文件中写入了100个整数进去的时候，我们认为在文件中写入了100个整数，并且我们存储成一个堆文件。要注意这个顺序只是一个逻辑顺序，这个文件在磁盘上怎么存储的我们是无法得知的。

一个磁盘包含了多个磁盘，磁头臂由马达带动，一个文件在磁盘上不一定存到了哪里，有可能散布在磁盘的各个地方。想找到文件中整数的位置，FAT\NTFS文件系统就包含了物理底层的存储位置。我们想在一个磁道上顺序存储那100个整数的时候是做不到的。在关系型数据库中确实有这个需要，因为数据库系统有一个很大的平静就是磁盘的访问。由于摩尔定律，每18个月，性能翻倍，磁盘的基本操作是寻道，50~60整数读取的时候，需要先按照文件存取表找到磁道位置，然后驱动磁头寻道，切割磁力线并读取数据。由于磁头移动是机械运动，转速和马达的改进，再改进也无法使磁盘寻道效率翻倍，这个时候查询性能的平静就在磁盘读取上。

将之前的文件换成学生基本信息表，学号9090101学生到9090133学生，在学生基本信息表中按照学号顺序插入，到了磁盘上会散布在不同的位置，这个时候如果想打印三十个人的学生名单，就是从第一个学号循环到最后一个学生。之前是逻辑概念，在物理磁盘上实现的时候，需要磁盘不停移动，这时候学生基本信息表如果能按照学号在物理上也是连续排列，就可以减少磁头移动提高效率。如何实现这一点？操作系统存在的情况下是无法实现这一点的。

磁盘碎块整理实际上就是在移动碎块变成一个连续的块。UNIX操作系统最早支持了RAW DISK，Windows系统也逐渐支持了RAW DISK，这个功能允许用户向底层申请连续区域，借助系统调用自己实现一个文件管理，在自己实现的文件管理中可以实现自己摆放文件。很多数据库都是这样实现的，数据库空间500M或者1G的时候，一定会在操作系统层找到一个500M或者1G的大文件。

如果把某个关系中的元组按照物理顺序存储，这种存储方式就称为cluster（簇集）。学生基本信息表按照学号值查询的时候就非常方便，但是按照年龄或者姓名查询的时候就没有什么帮助。所以这个时候需要对数据访问进行分析，如果某个属性是非常频繁使用的查询属性，就可以在那个属性上使用簇集存储，其他常用属性可以建立B+树索引。簇集也需要维护，一般情况下，簇集属性最好是不需要经常修改的。因为修改物理上的存储，维护代价是很大的。所以需要这个属性不能经常修改，减少维护代价。

总结一下常用的索引技术：
- B+树索引（最常用）
- 簇集cluster，簇集存储方式本身就是一种索引
- 倒排文件（inverted file），在文献检索系统中比较多
- 动态哈希
- 栅格结构文件和分区哈希（partitioned hash）函数
- 位图索引（bitmap index），第八章讲解数据仓库系统的时候会介绍，在数据仓库中很常见，关系型数据中比较少用
- R树索引（空间数据结构）

关系型数据库最常见的是前两种。

### **4.3.2 访问原语**

这部分在研究生课程中有介绍。